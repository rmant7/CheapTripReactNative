{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import{Platform}from'expo-modules-core';import{getAssetByID}from\"./AssetRegistry\";import{selectAssetSource}from\"./AssetSources\";import*as AssetUris from\"./AssetUris\";import*as ImageAssets from\"./ImageAssets\";import{getLocalAssetUri}from\"./LocalAssets\";import{downloadAsync as _downloadAsync,IS_ENV_WITH_UPDATES_ENABLED}from\"./PlatformUtils\";import resolveAssetSource from\"./resolveAssetSource\";export var Asset=function(){function Asset(_ref){var name=_ref.name,type=_ref.type,_ref$hash=_ref.hash,hash=_ref$hash===void 0?null:_ref$hash,uri=_ref.uri,width=_ref.width,height=_ref.height;_classCallCheck(this,Asset);this.hash=null;this.localUri=null;this.width=null;this.height=null;this.downloading=false;this.downloaded=false;this._downloadCallbacks=[];this.name=name;this.type=type;this.hash=hash;this.uri=uri;if(typeof width==='number'){this.width=width;}if(typeof height==='number'){this.height=height;}if(hash){this.localUri=getLocalAssetUri(hash,type);if(this.localUri){this.downloaded=true;}}if(Platform.OS==='web'){if(!name){this.name=AssetUris.getFilename(uri);}if(!type){this.type=AssetUris.getFileExtension(uri);}}}_createClass(Asset,[{key:\"downloadAsync\",value:function(){var _downloadAsync2=_asyncToGenerator(function*(){var _this=this;if(this.downloaded){return this;}if(this.downloading){yield new Promise(function(resolve,reject){_this._downloadCallbacks.push({resolve:resolve,reject:reject});});return this;}this.downloading=true;try{if(Platform.OS==='web'){if(ImageAssets.isImageType(this.type)){var _yield$ImageAssets$ge=yield ImageAssets.getImageInfoAsync(this.uri),width=_yield$ImageAssets$ge.width,height=_yield$ImageAssets$ge.height,name=_yield$ImageAssets$ge.name;this.width=width;this.height=height;this.name=name;}else{this.name=AssetUris.getFilename(this.uri);}}this.localUri=yield _downloadAsync(this.uri,this.hash,this.type,this.name);this.downloaded=true;this._downloadCallbacks.forEach(function(_ref2){var resolve=_ref2.resolve;return resolve();});}catch(e){this._downloadCallbacks.forEach(function(_ref3){var reject=_ref3.reject;return reject(e);});throw e;}finally{this.downloading=false;this._downloadCallbacks=[];}return this;});function downloadAsync(){return _downloadAsync2.apply(this,arguments);}return downloadAsync;}()}],[{key:\"loadAsync\",value:function loadAsync(moduleId){var moduleIds=Array.isArray(moduleId)?moduleId:[moduleId];return Promise.all(moduleIds.map(function(moduleId){return Asset.fromModule(moduleId).downloadAsync();}));}},{key:\"fromModule\",value:function fromModule(virtualAssetModule){if(typeof virtualAssetModule==='string'){return Asset.fromURI(virtualAssetModule);}var meta=getAssetByID(virtualAssetModule);if(!meta){throw new Error(\"Module \\\"\"+virtualAssetModule+\"\\\" is missing from the asset registry\");}if(!IS_ENV_WITH_UPDATES_ENABLED){var _resolveAssetSource=resolveAssetSource(virtualAssetModule),uri=_resolveAssetSource.uri;var asset=new Asset({name:meta.name,type:meta.type,hash:meta.hash,uri:uri,width:meta.width,height:meta.height});if(Platform.OS==='android'&&!uri.includes(':')&&(meta.width||meta.height)){asset.localUri=asset.uri;asset.downloaded=true;}Asset.byHash[meta.hash]=asset;return asset;}return Asset.fromMetadata(meta);}},{key:\"fromMetadata\",value:function fromMetadata(meta){var metaHash=meta.hash;if(Asset.byHash[metaHash]){return Asset.byHash[metaHash];}var _selectAssetSource=selectAssetSource(meta),uri=_selectAssetSource.uri,hash=_selectAssetSource.hash;var asset=new Asset({name:meta.name,type:meta.type,hash:hash,uri:uri,width:meta.width,height:meta.height});Asset.byHash[metaHash]=asset;return asset;}},{key:\"fromURI\",value:function fromURI(uri){if(Asset.byUri[uri]){return Asset.byUri[uri];}var type='';if(uri.indexOf(';base64')>-1){type=uri.split(';')[0].split('/')[1];}else{var extension=AssetUris.getFileExtension(uri);type=extension.startsWith('.')?extension.substring(1):extension;}var asset=new Asset({name:'',type:type,hash:null,uri:uri});Asset.byUri[uri]=asset;return asset;}}]);return Asset;}();Asset.byHash={};Asset.byUri={};","map":{"version":3,"sources":["../src/Asset.ts"],"names":[],"mappings":"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","sourcesContent":["import { Platform } from 'expo-modules-core';\n\nimport { getAssetByID } from './AssetRegistry';\nimport { AssetMetadata, selectAssetSource } from './AssetSources';\nimport * as AssetUris from './AssetUris';\nimport * as ImageAssets from './ImageAssets';\nimport { getLocalAssetUri } from './LocalAssets';\nimport { downloadAsync, IS_ENV_WITH_UPDATES_ENABLED } from './PlatformUtils';\nimport resolveAssetSource from './resolveAssetSource';\n\n// @docsMissing\nexport type AssetDescriptor = {\n  name: string;\n  type: string;\n  hash?: string | null;\n  uri: string;\n  width?: number | null;\n  height?: number | null;\n};\n\ntype DownloadPromiseCallbacks = {\n  resolve: () => void;\n  reject: (error: Error) => void;\n};\n\nexport { AssetMetadata };\n\n// @needsAudit\n/**\n * The `Asset` class represents an asset in your app. It gives metadata about the asset (such as its\n * name and type) and provides facilities to load the asset data.\n */\nexport class Asset {\n  /**\n   * @private\n   */\n  static byHash = {};\n  /**\n   * @private\n   */\n  static byUri = {};\n\n  /**\n   * The name of the asset file without the extension. Also without the part from `@` onward in the\n   * filename (used to specify scale factor for images).\n   */\n  name: string;\n  /**\n   * The extension of the asset filename.\n   */\n  type: string;\n  /**\n   * The MD5 hash of the asset's data.\n   */\n  hash: string | null = null;\n  /**\n   * A URI that points to the asset's data on the remote server. When running the published version\n   * of your app, this refers to the location on Expo's asset server where Expo has stored your\n   * asset. When running the app from Expo CLI during development, this URI points to Expo CLI's\n   * server running on your computer and the asset is served directly from your computer.\n   */\n  uri: string;\n  /**\n   * If the asset has been downloaded (by calling [`downloadAsync()`](#downloadasync)), the\n   * `file://` URI pointing to the local file on the device that contains the asset data.\n   */\n  localUri: string | null = null;\n  /**\n   * If the asset is an image, the width of the image data divided by the scale factor. The scale\n   * factor is the number after `@` in the filename, or `1` if not present.\n   */\n  width: number | null = null;\n  /**\n   * If the asset is an image, the height of the image data divided by the scale factor. The scale factor is the number after `@` in the filename, or `1` if not present.\n   */\n  height: number | null = null;\n  // @docsMissing\n  downloading: boolean = false;\n  // @docsMissing\n  downloaded: boolean = false;\n\n  /**\n   * @private\n   */\n  _downloadCallbacks: DownloadPromiseCallbacks[] = [];\n\n  constructor({ name, type, hash = null, uri, width, height }: AssetDescriptor) {\n    this.name = name;\n    this.type = type;\n    this.hash = hash;\n    this.uri = uri;\n\n    if (typeof width === 'number') {\n      this.width = width;\n    }\n    if (typeof height === 'number') {\n      this.height = height;\n    }\n\n    if (hash) {\n      this.localUri = getLocalAssetUri(hash, type);\n      if (this.localUri) {\n        this.downloaded = true;\n      }\n    }\n\n    if (Platform.OS === 'web') {\n      if (!name) {\n        this.name = AssetUris.getFilename(uri);\n      }\n      if (!type) {\n        this.type = AssetUris.getFileExtension(uri);\n      }\n    }\n  }\n\n  // @needsAudit\n  /**\n   * A helper that wraps `Asset.fromModule(module).downloadAsync` for convenience.\n   * @param moduleId An array of `require('path/to/file')` or external network URLs. Can also be\n   * just one module or URL without an Array.\n   * @return Returns a Promise that fulfills with an array of `Asset`s when the asset(s) has been\n   * saved to disk.\n   * @example\n   * ```ts\n   * const [{ localUri }] = await Asset.loadAsync(require('./assets/snack-icon.png'));\n   * ```\n   */\n  static loadAsync(moduleId: number | number[] | string | string[]): Promise<Asset[]> {\n    const moduleIds = Array.isArray(moduleId) ? moduleId : [moduleId];\n    return Promise.all(moduleIds.map((moduleId) => Asset.fromModule(moduleId).downloadAsync()));\n  }\n\n  // @needsAudit\n  /**\n   * Returns the [`Asset`](#asset) instance representing an asset given its module or URL.\n   * @param virtualAssetModule The value of `require('path/to/file')` for the asset or external\n   * network URL\n   * @return The [`Asset`](#asset) instance for the asset.\n   */\n  static fromModule(virtualAssetModule: number | string): Asset {\n    if (typeof virtualAssetModule === 'string') {\n      return Asset.fromURI(virtualAssetModule);\n    }\n\n    const meta = getAssetByID(virtualAssetModule);\n    if (!meta) {\n      throw new Error(`Module \"${virtualAssetModule}\" is missing from the asset registry`);\n    }\n\n    // Outside of the managed env we need the moduleId to initialize the asset\n    // because resolveAssetSource depends on it\n    if (!IS_ENV_WITH_UPDATES_ENABLED) {\n      const { uri } = resolveAssetSource(virtualAssetModule);\n      const asset = new Asset({\n        name: meta.name,\n        type: meta.type,\n        hash: meta.hash,\n        uri,\n        width: meta.width,\n        height: meta.height,\n      });\n\n      // TODO: FileSystem should probably support 'downloading' from drawable\n      // resources But for now it doesn't (it only supports raw resources) and\n      // React Native's Image works fine with drawable resource names for\n      // images.\n      if (Platform.OS === 'android' && !uri.includes(':') && (meta.width || meta.height)) {\n        asset.localUri = asset.uri;\n        asset.downloaded = true;\n      }\n\n      Asset.byHash[meta.hash] = asset;\n      return asset;\n    }\n\n    return Asset.fromMetadata(meta);\n  }\n\n  // @docsMissing\n  static fromMetadata(meta: AssetMetadata): Asset {\n    // The hash of the whole asset, not to be confused with the hash of a specific file returned\n    // from `selectAssetSource`\n    const metaHash = meta.hash;\n    if (Asset.byHash[metaHash]) {\n      return Asset.byHash[metaHash];\n    }\n\n    const { uri, hash } = selectAssetSource(meta);\n    const asset = new Asset({\n      name: meta.name,\n      type: meta.type,\n      hash,\n      uri,\n      width: meta.width,\n      height: meta.height,\n    });\n    Asset.byHash[metaHash] = asset;\n    return asset;\n  }\n\n  // @docsMissing\n  static fromURI(uri: string): Asset {\n    if (Asset.byUri[uri]) {\n      return Asset.byUri[uri];\n    }\n\n    // Possibly a Base64-encoded URI\n    let type = '';\n    if (uri.indexOf(';base64') > -1) {\n      type = uri.split(';')[0].split('/')[1];\n    } else {\n      const extension = AssetUris.getFileExtension(uri);\n      type = extension.startsWith('.') ? extension.substring(1) : extension;\n    }\n\n    const asset = new Asset({\n      name: '',\n      type,\n      hash: null,\n      uri,\n    });\n\n    Asset.byUri[uri] = asset;\n\n    return asset;\n  }\n\n  // @needsAudit\n  /**\n   * Downloads the asset data to a local file in the device's cache directory. Once the returned\n   * promise is fulfilled without error, the [`localUri`](#assetlocaluri) field of this asset points\n   * to a local file containing the asset data. The asset is only downloaded if an up-to-date local\n   * file for the asset isn't already present due to an earlier download. The downloaded `Asset`\n   * will be returned when the promise is resolved.\n   * @return Returns a Promise which fulfills with an `Asset` instance.\n   */\n  async downloadAsync(): Promise<this> {\n    if (this.downloaded) {\n      return this;\n    }\n    if (this.downloading) {\n      await new Promise<void>((resolve, reject) => {\n        this._downloadCallbacks.push({ resolve, reject });\n      });\n      return this;\n    }\n    this.downloading = true;\n\n    try {\n      if (Platform.OS === 'web') {\n        if (ImageAssets.isImageType(this.type)) {\n          const { width, height, name } = await ImageAssets.getImageInfoAsync(this.uri);\n          this.width = width;\n          this.height = height;\n          this.name = name;\n        } else {\n          this.name = AssetUris.getFilename(this.uri);\n        }\n      }\n      this.localUri = await downloadAsync(this.uri, this.hash, this.type, this.name);\n\n      this.downloaded = true;\n      this._downloadCallbacks.forEach(({ resolve }) => resolve());\n    } catch (e) {\n      this._downloadCallbacks.forEach(({ reject }) => reject(e));\n      throw e;\n    } finally {\n      this.downloading = false;\n      this._downloadCallbacks = [];\n    }\n    return this;\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}